<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>设计模式 | Wqy&#39;s Home Page | Impossible is nothing.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="theme-color" content="#9C27B0">
  
  
  <meta name="keywords" content="">
  <meta name="description" content="设计模式单例模式静态实例方式1234567public class Singleton &amp;#123;    private static Singleton instance = new Singleton();    private Singleton() &amp;#123;&amp;#125;    public static Singleton getInstance() &amp;#123;        re">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="http://WqyJh.github.io/2016/12/20/设计模式/index.html">
<meta property="og:site_name" content="Wqy's Home Page">
<meta property="og:description" content="设计模式单例模式静态实例方式1234567public class Singleton &amp;#123;    private static Singleton instance = new Singleton();    private Singleton() &amp;#123;&amp;#125;    public static Singleton getInstance() &amp;#123;        re">
<meta property="og:image" content="http://oih52y89x.bkt.clouddn.com/BrigePattern.png">
<meta property="og:image" content="http://oih52y89x.bkt.clouddn.com/brige-pattern-instance2.png">
<meta property="og:image" content="http://oih52y89x.bkt.clouddn.com/Printer1.png">
<meta property="og:image" content="http://oih52y89x.bkt.clouddn.com/Printer2.png">
<meta property="og:image" content="http://oih52y89x.bkt.clouddn.com/Printer3.png">
<meta property="og:updated_time" content="2016-12-20T11:37:49.723Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="设计模式">
<meta name="twitter:description" content="设计模式单例模式静态实例方式1234567public class Singleton &amp;#123;    private static Singleton instance = new Singleton();    private Singleton() &amp;#123;&amp;#125;    public static Singleton getInstance() &amp;#123;        re">
<meta name="twitter:image" content="http://oih52y89x.bkt.clouddn.com/BrigePattern.png">
  
    <link rel="alternative" href="/atom.xml" title="Wqy&#39;s Home Page" type="application/atom+xml">
  
  <meta name="summary" content="Stay hungry, stay foolish!">

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div style="display:none">
    <img src="/img/logo.jpg" alt="分享图标" />
  </div>
  <div id="loading" class="active"></div>

  <nav id="menu" class="hide" >
   <div class="inner flex-row-vertical">
  <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
      <i class="icon icon-lg icon-close"></i>
  </a>
  <div class="brand-wrap">
    <div class="brand">
      <a href="/" class="avatar"><img src="/img/logo.jpg"></a>
      <hgroup class="introduce">
        <h5 class="nickname">wqy</h5>
        <a href="mailto:781345688@qq.com" title="781345688@qq.com" class="mail">781345688@qq.com</a>
      </hgroup>
    </div>
  </div>
  <div class="scroll-wrap flex-col">
    <ul class="nav">
      
          <li class="waves-block waves-effect">
            <a href="/"  >
              <i class="icon icon-lg icon-home"></i>
              主页
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/archives"  >
              <i class="icon icon-lg icon-archives"></i>
              Archives
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/tags"  >
              <i class="icon icon-lg icon-tags"></i>
              Tags
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/categories"  >
              <i class="icon icon-lg icon-categories"></i>
              Categories
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="https://github.com/WqyJh" target="_blank" >
              <i class="icon icon-lg icon-github"></i>
              Github
            </a>
          </li>
      
    </ul>

    <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>Wqy&#39;s Home Page &copy; 2016</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>

  </div>
</div>

  </nav>
  <main id="main">
    <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">设计模式</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input " autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-share">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header">
  <div class="container">
    <h1 class="author">设计模式</h1>
    <h5 class="subtitle">
        
            <time datetime="2016-12-20T11:37:14.000Z" itemprop="datePublished" class="page-time">
  2016-12-20
</time>


        
    </h5>
  </div>
</header>

    <div class="container body-wrap">
      <article id="post-设计模式" 
  class="article article-type-post" itemprop="blogPost">
    <div class="post-meta flex-row">
        

    </div>
    <div class="post-body">
        <aside class="post-widget" id="post-widget">

            
            <div class="post-share" id="post-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>

            

            
            <nav class="post-toc-wrap" id="post-toc">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#设计模式"><span class="post-toc-number">1.</span> <span class="post-toc-text">设计模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#单例模式"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">单例模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#静态实例方式"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">静态实例方式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#懒加载单例（线程不安全版）"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">懒加载单例（线程不安全版）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#懒加载单例（线程安全版）"><span class="post-toc-number">1.1.3.</span> <span class="post-toc-text">懒加载单例（线程安全版）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#双重检验锁"><span class="post-toc-number">1.1.4.</span> <span class="post-toc-text">双重检验锁</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#饿汉式（唯一静态变量）"><span class="post-toc-number">1.1.5.</span> <span class="post-toc-text">饿汉式（唯一静态变量）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#静态内部类"><span class="post-toc-number">1.1.6.</span> <span class="post-toc-text">静态内部类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#枚举-Enum"><span class="post-toc-number">1.1.7.</span> <span class="post-toc-text">枚举 Enum</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#登记式单例"><span class="post-toc-number">1.1.8.</span> <span class="post-toc-text">登记式单例</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#桥接模式"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">桥接模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#结构"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">结构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#举个栗子"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">举个栗子</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#一种思路"><span class="post-toc-number">1.2.2.1.</span> <span class="post-toc-text">一种思路</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#解决方案"><span class="post-toc-number">1.2.2.2.</span> <span class="post-toc-text">解决方案</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#应用"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">应用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#本质"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">本质</span></a></li></ol></li></ol></li></ol>
            </nav>
            
        </aside>

        <div class="post-main">

            <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><h3 id="静态实例方式"><a href="#静态实例方式" class="headerlink" title="静态实例方式"></a>静态实例方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class Singleton &#123;</div><div class="line">    private static Singleton instance = new Singleton();</div><div class="line">    private Singleton() &#123;&#125;</div><div class="line">    public static Singleton getInstance() &#123;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种实现方法有一个很大的缺点，在类加载的时候 instance 就会被实例化，即使加载器是静态的。因此对于资源密集，配置开销比较大的单例更合理的做法是将实例化推迟到使用它的时候。即懒加载。</p>
<h3 id="懒加载单例（线程不安全版）"><a href="#懒加载单例（线程不安全版）" class="headerlink" title="懒加载单例（线程不安全版）"></a>懒加载单例（线程不安全版）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class LazySingleton &#123;</div><div class="line">    private static LazySingleton instance = null;</div><div class="line">    private LazySingleton() &#123;&#125;</div><div class="line">    public static LazySingleton getInstance() &#123;</div><div class="line">        if (instance == null) &#123;</div><div class="line">            instance = new LazySingleton();</div><div class="line">        &#125;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种方式用到了懒加载，将实例化推迟到了使用的时候，但是当多个线程同时调用<code>getInstance()</code>的时候，就有可能创建多个实例。</p>
<h3 id="懒加载单例（线程安全版）"><a href="#懒加载单例（线程安全版）" class="headerlink" title="懒加载单例（线程安全版）"></a>懒加载单例（线程安全版）</h3><p>为了解决上面的的问题，可以将<code>getInstance()</code>方法设置为同步方法（synchronized）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public static synchronized LazySingleton getInstance() &#123;</div><div class="line">    if (instance == null) &#123;</div><div class="line">        instance = new LazySingleton();</div><div class="line">    &#125;</div><div class="line">    return instance;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>但是这样虽然做到了线程安全，解决了多实例的问题，但是它并不高效。因为任何时候只能有一个线程调用<code>getInstance()</code>方法，其它线程都会阻塞。</p>
<h3 id="双重检验锁"><a href="#双重检验锁" class="headerlink" title="双重检验锁"></a>双重检验锁</h3><p>双重检验锁模式（double checked locking pattern）是一种同步块加锁的方法。因为会有两次检查<code>instance == null</code>，一次是在同步块外，一次是在同步块内。这样做是因为可能会有多个线程一起进入同步块外的检查，但是只有一个线程才能进入同步块内，这样就保证了多个线程只生成一个实例，而多个线程又能同时获得实例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public static Singleton getInstance() &#123;</div><div class="line">    if (instance == null) &#123;</div><div class="line">        synchronized (Singleton.class) &#123;</div><div class="line">            if (instance == null) &#123;</div><div class="line">                instance = new Singleton();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return instance;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这段代码还有一些问题，因为<code>instance = new Singleton()</code>并不是一个原子操作，在 JVM 中这行代码大概做了 3 件事：</p>
<ol>
<li>给 instance 分配内存</li>
<li>调用 Singleton 的构造方法来初始化成员变量</li>
<li>将 instance 指向对象分配的内存空间</li>
</ol>
<p>但是在 JVM 的即时编译器中存在指令重排序的优化。所以上面的第二步和第三步的顺序不能保证，如果第三步比第二步先执行，这时 instance 就不为空了，如果有线程这时调用了 <code>getInstance()</code>方法，就会跳过外层检查，直接得到实例，用该实例访问成员变量就会出错。</p>
<p>关于指令重排序: <a href="http://ifeve.com/jvm-memory-reordering/" target="_blank" rel="external">http://ifeve.com/jvm-memory-reordering/</a></p>
<p>解决方案就是吧 instance 变量声明成<code>volatile</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private volatile static Singleton instance;</div></pre></td></tr></table></figure></p>
<p>这里使用 volatile 的原因是 volatile 声明的变量会禁止指令重排序优化。<br>但是 Java 5 以前的版本存在内存缺陷，不能避免指令重拍序。</p>
<h3 id="饿汉式（唯一静态变量）"><a href="#饿汉式（唯一静态变量）" class="headerlink" title="饿汉式（唯一静态变量）"></a>饿汉式（唯一静态变量）</h3><p>饿汉式单例是指单例类在被加载的时候，唯一实例就已经被创建。<br>将单例的实例声明为<code>static</code>和<code>final</code>变量，在类加载的时候就会初始化，所以创建实例是线程安全的，不需要<code>synchronized</code>和<code>instance == null</code>的检验了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class Singleton&#123;</div><div class="line">    private static final Singleton instance = new Singleton();</div><div class="line"></div><div class="line">    private Singleton()&#123;&#125;</div><div class="line"></div><div class="line">    public static Singleton getInstance()&#123;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>但是这种方式也有缺陷，<code>getInstance()</code>方法不是由外部调用，无法传入参数来初始化，而且也没有懒加载。</p>
<h3 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class Singleton &#123;  </div><div class="line">    private static class SingletonHolder &#123;  </div><div class="line">        private static final Singleton INSTANCE = new Singleton();  </div><div class="line">    &#125;  </div><div class="line">    private Singleton ()&#123;&#125;  </div><div class="line">    public static final Singleton getInstance() &#123;  </div><div class="line">        return SingletonHolder.INSTANCE;</div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种方法即简洁明了地保证了线程安全，又有懒加载的特性，因为只有在第一次调用<code>getInstance()</code>方法的时候，会加载<code>SingletonHolder</code>类并初始化<code>INSTANCE</code>。当然，它也不能配置。</p>
<h3 id="枚举-Enum"><a href="#枚举-Enum" class="headerlink" title="枚举 Enum"></a>枚举 Enum</h3><p>单元素的枚举类型已经成为实现 Singleton 的最佳方法。Java 的枚举类型实际上是功能齐全的类，因此可以有自己的属性和方法。Java 枚举类型的基本思想是通过公有的静态 final 域为每个枚举常量导出实例的类。<br>用枚举实现单例非常简单，只需要编写一个包含单个元素的枚举类型即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;</div><div class="line">	instance;</div><div class="line">	<span class="comment">// fields</span></div><div class="line">	<span class="comment">// methods</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 直接用 Singleton.instance 既可以使用</span></div></pre></td></tr></table></figure></p>
<h3 id="登记式单例"><a href="#登记式单例" class="headerlink" title="登记式单例"></a>登记式单例</h3><p>单例模式的本质是控制实例数目，那有没有可能使实例的数目为2个、3个或其它个数呢？<br>可以用<code>Map</code>来缓存实例，实现登记式单例，实例的个数可以自由的控制。<br>大概思路如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Instance <span class="title">getInstance</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">	Instance instance = map.get(key);</div><div class="line">	<span class="keyword">if</span> (Object.isNull(instance)) &#123;</div><div class="line">		instance = <span class="keyword">new</span> Instance();</div><div class="line">		map.put(key, instance);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> instance;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意这段代码并不是线程安全的，需要特别处理，可以参考懒汉式单例。</p>
<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><p>它是一种对象结构型模式，又称为柄体 (Handle and Body) 模式或接口 (Interface) 模式。<br><img src="http://oih52y89x.bkt.clouddn.com/BrigePattern.png" alt="@桥接模式的结构|center"></p>
<h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><p>桥接模式包含如下角色：</p>
<ul>
<li><code>Abstraction</code>：抽象类，持有一个<code>Implementor</code>的实例</li>
<li><code>RefinedAbstraction</code>：扩充抽象类</li>
<li><code>Implementor</code>：实现类接口</li>
<li><code>ConcreteImplementor</code>：具体实现类</li>
</ul>
<h3 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h3><p>假设有一台打印机可以彩色打印也可以黑白打印，可以单面打印也可以双面打印，要实现这台打印机的控制流程，应该怎么做？<br><img src="http://oih52y89x.bkt.clouddn.com/brige-pattern-instance2.png" alt="@打印机|center"></p>
<h4 id="一种思路"><a href="#一种思路" class="headerlink" title="一种思路"></a>一种思路</h4><p><img src="http://oih52y89x.bkt.clouddn.com/Printer1.png" alt="@抽象接口|center"><br>建立一个抽象接口<code>Printer</code>，然后实现彩色打印和黑白打印的功能，再在彩色答应和黑白打印的基础上增加单面打印和双面打印的功能。<br>这样做是可行的，Java 的 IO 库就是这么做的，定义一个<code>Stream</code>接口，再派生出<code>InputStream</code>和<code>OutputStream</code>，然后又派生出<code>BufferedInputStream</code>和<code>BufferedOutputStream</code>还有<code>FileInputStream</code>等等。<br>但仔细想想就会发现这对程序员简直是一个噩梦，如果这时候新增一个打印照片的功能呢。<br><img src="http://oih52y89x.bkt.clouddn.com/Printer2.png" alt="@增加打印照片的功能|center"><br>真棒，我们又写了两个类！如果再增加一种打印呢，比如说雾面打印（扯）？每增加一个功能就要多写两个类，如果除了单页和双页还有别的方式呢？<br>Java IO 库中这么写是因为 Input 和 Output 不可避免的是两个对立的操作（也许只写一个流，通过改变方向来实现 Input / Output 也可以，但这样会损失代码的语义，还有可能影响性能，毕竟 IO 操作是非常注重性能的）。而且 IO 仅有 Input / Output 这两种操作，那么其中一个维度的控件大小就已经确定为二了，所以每增加一个流的实现要增加两个类。<br>但是我们现在面临的具体问题是，两个维度都有可能发生变化，以这种结构来写，我们将要实现<code>N * M</code>个类，维护的代价还是相当大的，而且不同的实现类可能有很多代码重复，比如<code>ColoredPrinter</code>的子类就都要调用父类的方法来实现彩色打印，然后再执行自己的业务代码。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>用桥接模式来重构吧！<br><img src="http://oih52y89x.bkt.clouddn.com/Printer3.png" alt="@用桥接模式来重构|center"><br>上图中<code>Printer</code>是一个抽象类，<code>print()</code>是抽象方法。<br>这样改进后，每增加一种颜色方案时，只需增加一个<code>Printer</code>的实现类，每增加一种页面方案的时候只需增加一个<code>PrinterImpl</code>的实现类，大大减少了要维护的代码量。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 彩色单面打印</span></div><div class="line">Printer coloredSinglePrinter = <span class="keyword">new</span> ColoredPrinter();</div><div class="line">coloredSinglePrinter.setPrinterImpl(<span class="keyword">new</span> SinglePrinter());</div><div class="line">coloredSinglePrinter.print();</div><div class="line"></div><div class="line"><span class="comment">// 黑白双面打印</span></div><div class="line">Printer blackDoublePrinter = <span class="keyword">new</span> BlackPrinter();</div><div class="line">blackDoublePrinter.setPrinterImpl(<span class="keyword">new</span> DoublePrinter());</div><div class="line">blackDoublePrinter.print();</div></pre></td></tr></table></figure></p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>大部分的跨平台 SDK 都是桥接模式的应用，例如 JDBC、OpenGL、游戏引擎等。他们提供的 API 接口就是桥接模式中的<code>Abstraction</code>，在各个平台上的实现就是对<code>Implementor</code>的具体实现，我们在使用的时候，只需要获得一个<code>Abstraction</code>的实例，然后调用实例的<code>operation()</code>就可以完成我们的业务逻辑了。<br>就拿 JDBC 来说，JDBC API 对应着<code>Abstraction</code>，而 JDBC Driver 就是<code>Implementor</code>接口，各个数据库提供商提供的数据库驱动就是这一接口的具体实现。我们使用 JDBC 的时候，是针对 JDBC API 编程，即客户端只与<code>Abstraction</code>交互。图中的<code>RefinedAbstraction</code>是对<code>Abstraction</code>的扩展。<br>说的具体一点就是 JDBC 里的<code>Connection</code>和<code>Statment</code>对应着桥接模式里的<code>Abstraction</code>，<code>PreparedStatment</code>可以视作一个<code>RefinedAbstraction</code>。</p>
<h3 id="本质"><a href="#本质" class="headerlink" title="本质"></a>本质</h3><p>桥接模式的应用非常广泛，其本质就是面向抽象编程。利用组合关系而不是继承，分离多个维度的抽象和实现部分，使他们都可以独立变化。如果做一件事有两个维度的变化量（比如说两个团队开发的两个组件之间需要交互），那么不要考虑，就用桥接模式吧！<br>当然多个维度也是可以的，不过要根据业务逻辑来决定接口之间的关联关系。我们在开发中使用的第三方依赖，如果它还依赖与其它第三方库，这就可以视为一个桥接链。如果我们使用的两个依赖，他们之间也有依赖关系，就是一个多维度的桥接关系，我们只面向库提供的接口编程，一个库内部实现的改变不会影响我们编码，也不会影响另一个库（前提是不改变接口），一个库扩展出新的功能，我们和第三方都只要做很小的改动就能使用这个功能，而且不会影响原有代码的稳定。</p>


            
            <div class="post-reward">
                <a id="rewardBtn" href="javascript:;" class="post-reward-btn waves-effect waves-circle waves-light">赏</a>
            </div>
            
            
            <blockquote>
                <p>
                本文地址：
                <a href="http://WqyJh.github.io/2016/12/20/设计模式/" target="_blank" rel="external">http://WqyJh.github.io/2016/12/20/设计模式/</a>
                </p>
                <footer><cite><a href="http://WqyJh.github.io">@Wqy's Home Page</a></cite></footer>
            </blockquote>
            </div>
            
<nav class="post-nav">
  

  
    <div class="waves-block waves-effect next fr">
      <a href="/2016/11/18/UML建模/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">UML建模</h4>
      </a>
    </div>
  
</nav>


            
            



        </div>
    </div>
</article>
    </div>
  </main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>

<script>
var BLOG_SHARE = {
    title: "设计模式",
    pic: "/img/logo.jpg",
    summary: document.getElementsByName('summary')[0].content,
    url: "http://WqyJh.github.io/2016/12/20/设计模式/index.html"
};
</script>
<div class="global-share" id="global-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>




<div id="reward" class="reward-lay">
    <a class="reward-off" id="rewardOff" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="/img/wechat.jpg" title="微信打赏二维码" alt="微信打赏二维码">
            <p>微信</p>
        </li>
        

        
        <li>
            <img src="/img/alipay.jpg" title="支付宝打赏二维码" alt="支付宝打赏二维码">
            <p>支付宝</p>
        </li>
        
    </ul>
</div>

<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script src="/js/main.js"></script>



<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<script type="text/template" id="search-tpl">
<li class="item">
    <a href="/{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</script>

<script src="/js/search.js"></script>





<script src="//s95.cnzz.com/z_stat.php?id=1260528788&web_id=1260528788"></script>





<script type="text/javascript">
  var msg_desc = document.getElementsByName('summary')[0].content;
</script>
</body>
</html>
